# Phase 4 Evaluation & Analysis

> Draft artifact â€“ populate after running plotting, ablation, explanations, temporal split.

## 1. Overview
Phase 4 focuses on transforming raw experiment outputs into portfolio-quality evaluation assets (curves, ablations, explanations) and establishing CI quality gates prior to app integration.
### Methodology & Definitions
- NDCG@K: Discounted gain of binary relevance normalized by ideal ordering.
- MAP@K: Mean user average precision across users truncated at K.
- Coverage@K: Fraction of catalog items appearing at least once in users' top-K.
- Gini@K: Inequality of item recommendation frequency (higher = more concentrated).
- Cold-Start: Items lacking rating history; scored via content-only similarity and popularity priors.
- Temporal Split: Heuristic chronological partition (synthetic timestamp used if missing).
- Reproducibility: Seed=42; static Kaggle ratings; enrichment snapshot `202511_full`.

## 2. Metric Curves
(Embed figures after running `scripts/plot_phase4_metrics.py`)
- NDCG@K vs K: `reports/figures/phase4/ndcg_vs_k.png`
- MAP@K vs K: `reports/figures/phase4/map_vs_k.png`
Alt text:
- ndcg_vs_k: Accuracy curve; MF leads slightly, Hybrid near parity, Popularity lower.
- map_vs_k: MAP trend mirrors NDCG; content TF-IDF below CF methods.

## 3. Diversity Curves
- Coverage@K vs K: `reports/figures/phase4/coverage_vs_k.png`
- Gini@K vs K: `reports/figures/phase4/gini_vs_k.png`
Alt text:
- coverage_vs_k: Exposure increases with K; popularity curve remains narrow.
- gini_vs_k: Popularity higher Gini (concentration); Hybrid moderates concentration.

## 4. Ablation (K=10)
(Generated by `scripts/generate_phase4_ablation.py`)

Include table from `reports/phase4_ablation.md` and CSV `reports/phase4_ablation.csv`.

## 5. Hybrid Explanation Examples
Produced via `scripts/explain_hybrid_examples.py` -> `experiments/metrics/hybrid_explanations.json`.

Example (User 14593, Top-5 items component shares):

| Item ID | MF Score | kNN Score | Pop Score | MF Share | kNN Share | Pop Share | Total |
|---------|----------|-----------|-----------|----------|-----------|----------|-------|
| 918     | 8.2115   | 0.0096    | 0.2000    | 0.9751   | 0.0011    | 0.0237   | 8.4210 |
| 9969    | 8.2206   | 0.0082    | 0.1917    | 0.9763   | 0.0010    | 0.0228   | 8.4205 |
| 820     | 8.2097   | 0.0074    | 0.1689    | 0.9790   | 0.0009    | 0.0201   | 8.3860 |
| 32281   | 8.1645   | 0.0069    | 0.1923    | 0.9762   | 0.0008    | 0.0230   | 8.3637 |
| 19      | 8.1503   | 0.0145    | 0.1982    | 0.9746   | 0.0017    | 0.0237   | 8.3630 |

Observation: MF term dominates (>97% share) under current balanced weights; kNN injects minor diversity signal; popularity adds slight score lift.

## 6. Temporal Robustness
Artifact: `reports/artifacts/temporal_split_comparison.json`

Synthetic temporal split (train_frac=0.7, timestamp_source="synthetic from row index"):

| Metric | Value |
|--------|-------|
| NDCG@5 | 0.4399 |
| NDCG@10 | 0.4383 |
| NDCG@20 | 0.4453 |
| MAP@5 | 0.1534 |
| MAP@10 | 0.0897 |
| MAP@20 | 0.0739 |
| Coverage@10 | 0.0018 |
| Gini@10 | 0.5000 |

Interpretation: Scores appear high because synthetic ordering likely clusters interactions; coverage extremely low (0.18%) suggests popularity / MF concentration. Treat these as heuristic only until real timestamps are integrated.

## 7. Cold-Start Performance
Content-only evaluation (k=10, users=300):

| Model | NDCG@10 | MAP@10 |
|-------|---------|--------|
| TF-IDF Content | 0.02528 | 0.02073 |
| Embeddings Content | 0.01558 | 0.01317 |

Interpretation: TF-IDF features outperform embeddings in current cold-start configuration; consider genre/tag enrichment or embedding fine-tuning for lift.

## 8. Interpretation & Narrative
- Hybrid retains near-MF accuracy while improving coverage over popularity.
- Diversity trade-offs contextualized by Gini and coverage deltas.
- Temporal split heuristic indicates concentration risk (needs real timestamps for validation).
- Genre exposure & novelty (optional extensions) add fairness / long-tail narrative.

## 9. Next Steps (Phase 5 Preview)
- Integrate explanation JSON and curve data into Streamlit components.
- Add badges for cold-start items using content-only rationale.
- Provide interactive toggles for alternate hybrid weights.

## 10. Optional Diversity Extensions
- Genre Exposure: `reports/figures/phase4/genre_exposure_ratio.png` + JSON `reports/artifacts/genre_exposure.json` (ratio >1 => over-represented).
- Novelty Bias: `reports/figures/phase4/novelty_bias.png` + JSON `reports/artifacts/novelty_bias.json` (lower avg percentile => more novel).

## 11. Alternate Hybrid Weight Example
Generate second explanations (e.g. mf=0.7, knn=0.2, pop=0.1):
`python scripts/explain_hybrid_examples.py --w-mf 0.7 --w-knn 0.2 --w-pop 0.1 --out-suffix alt --max-users 3`
Artifact: `experiments/metrics/hybrid_explanations_alt.json`.

---
_Last updated: 2025-11-22_
